"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3291],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return f}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),f=o,b=d["".concat(l,".").concat(f)]||d[f]||u[f]||r;return n?a.createElement(b,i(i({ref:t},p),{},{components:n})):a.createElement(b,i({ref:t},p))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3915:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return f},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],s={sidebar_position:3},l="Pagination Philosophy",c={unversionedId:"webserver/pagination",id:"webserver/pagination",title:"Pagination Philosophy",description:"Implementing our safe pagination philosophy requires different kinds of pagination for different endpoints.",source:"@site/docs/webserver/pagination.md",sourceDirName:"webserver",slug:"/webserver/pagination",permalink:"/carp/docs/webserver/pagination",draft:!1,editUrl:"https://github.com/dcSpark/carp/docs/webserver/pagination.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Client API",permalink:"/carp/docs/webserver/client"},next:{title:"Minimum requirements",permalink:"/carp/docs/requirements"}},p={},u=[{value:"Block or Transaction-based data",id:"block-or-transaction-based-data",level:2},{value:"Non-block-based data",id:"non-block-based-data",level:2}],d={toc:u};function f(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"pagination-philosophy"},"Pagination Philosophy"),(0,r.kt)("p",null,"Implementing our safe pagination philosophy requires different kinds of pagination for different endpoints."),(0,r.kt)("h2",{id:"block-or-transaction-based-data"},"Block or Transaction-based data"),(0,r.kt)("p",null,"Having a clear start block and end block for these queries is important for two reasons:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Data changes over time. For example, a user could make a transaction while you are paginating over their account information which could lead to inconsistencies"),(0,r.kt)("li",{parentName:"ul"},"In Cardano, small rollbacks of 1~2 block are very frequent and expected (read Ouroboros for why), so it's important that the block you're using still exists between paginated calls")),(0,r.kt)("p",null,"However, paginating by blocks only is not enough to guarantee liveness as it's possible to hit the pagination limit partway through a block. To avoid this problem, the pagination needs to support a starting transaction inside the block for the next call to avoid duplication."),(0,r.kt)("p",null,"This is why all endpoints that rely on block or transaction data takes a ",(0,r.kt)("inlineCode",{parentName:"p"},"after")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"until")," parameter based on the above requirements."),(0,r.kt)("h2",{id:"non-block-based-data"},"Non-block-based data"),(0,r.kt)("p",null,"Some data does not strictly belong to a block or transaction and instead can appear in multiple transactions or blocks. One main example of this is addresses. Just because transaction that contains an address gets rolled back, it doesn't mean the address itself stops existing (it may still exist in other places)."),(0,r.kt)("p",null,"Although this isn't problematic in itself, it does cause an issue for pagination of queries that rely solely on these types. Some example queries of this type:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"All addresses for a set of credentials"),(0,r.kt)("li",{parentName:"ul"},"All asset names for a policy ID")),(0,r.kt)("p",null,"There are three ways you could implement pagination on these types:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Defining the return to be in lexicographic order. This doesn't work well because in the middle of paginating, a new transaction could introduce an address that is lexicographically before where your iterator is"),(0,r.kt)("li",{parentName:"ol"},"Paginate based off the auto-incrementing field. This means you have to expose some database internals to the user (the ID key), but it does mean you don't have to introduce any new data to your SQL schema for pagination. Usually paginating off of IDs would not be safe (since the data could be rolled back), but this is safe for these tables if they don't get deleted on rollbacks."),(0,r.kt)("li",{parentName:"ol"},'Paginate based off a "first seen at" row in the table that keeps track of when an address was first seen on-chain. These can then use this for pagination and also use this to automatically delete addresses on rollback. However, it means storing a few million new database entries.')),(0,r.kt)("p",null,"Based off the above, we prefer option (3) for pagination of these types."))}f.isMDXComponent=!0}}]);